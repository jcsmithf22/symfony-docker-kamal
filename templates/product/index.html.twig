{% extends 'base.html.twig' %}

{% block title %}Products
{% endblock %}

{% block body %}
    <div class="products__page" {{ stimulus_controller('view-toggle') }}>
        <div {{ stimulus_controller('disclosure') }} {{ stimulus_action('disclosure', 'open', 'search-focus:open-search@window') }}>
            <div class="padding-double product__title">
                <h1>
                    Products
                </h1>
                <div class="product__title-controls">
                    <button class="btn-faint btn-toggle" {{ stimulus_action('disclosure', 'toggle') }} {{ stimulus_target('disclosure', 'button') }}>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings2-icon lucide-settings-2"><path d="M14 17H5"/><path d="M19 7h-9"/><circle cx="17" cy="17" r="3"/><circle cx="7" cy="7" r="3"/></svg>
                    </button>
                </div>
            </div>

            <details {{ stimulus_target('disclosure', 'details') }} {% if searchTerm %} open {% endif %}>
                <summary style="display: none;"></summary>
                <div class="divider-block"></div>
                <div class="padding-inline-double padding-block">
                    <div class="hstack space-between gap-half">
                        <form class="box medium" method="get" action="{{ path('products') }}" data-turbo-frame="products" data-turbo-action="advance">
                            <div
                                class="vstack gap-half">
                                <!-- <label for="search">Search Products</label> -->
                                <div class="hstack gap-half" {{ stimulus_controller('search-focus', {'frame-id': 'products'}) }}>
                                    <input type="text" id="search" name="search" value="{{ searchTerm|default('') }}" placeholder="Enter product name..." {{ stimulus_target('search-focus', 'searchInput') }}>
                                    <div class="btn__group">
                                        <button type="submit" class="btn btn-square btn-faint" aria-label="Search">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search-icon lucide-search"><path d="m21 21-4.34-4.34"/><circle cx="11" cy="11" r="8"/></svg>
                                        </button>
                                        <a href="{{ path('products') }}" class="btn btn-faint btn-square" data-turbo-frame="products" data-turbo-action="advance" aria-label="Clear" {{ stimulus_action('search-focus', 'markClear') }}>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x-icon lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div class="hstack">
                            <button type="button" class="btn btn-faint btn-square" data-toggle="{{ viewMode == 'list' ? 'true' : 'false' }}" {{ stimulus_target('view-toggle', 'button') }} {{ stimulus_action('view-toggle', 'toggle') }}>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-grid2x2-icon lucide-grid-2x2"><path d="M12 3v18"/><path d="M3 12h18"/><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rows2-icon lucide-rows-2"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 12h18"/></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </details>
        </div>
        <div class="divider-block"></div>

        <turbo-frame id="products" target="_top">
            <div data-filtered="{{ searchTerm ? 'true' : 'false' }}" data-list="{{ viewMode == 'list' ? 'true' : 'false' }}" class="grid gap-px products" {{ stimulus_target('view-toggle', 'grid') }}>
                {% for product in products %}
                    <div class="padding-double product vstack space-between">
                        <div class="product__content">
                            <a class="product__name" href="{{ path('product_show', {id: product.id}) }}">{{ product.name }}</a>
                            <p class="product__category">{{ product.category ? categories[product.category] : 'All Categories' }}</p>
                            <div class="product__price">
                                <p>
                                    {% if product.minimumPrice %}
                                        ${{ (product.minimumPrice / 100)|number_format(2, '.', '') }} - ${{ (product.price / 100)|number_format(2, '.', '') }}
                                    {% else %}
                                        Less than ${{ (product.price / 100)|number_format(2, '.', '') }}
                                    {% endif %}
                                </p>
                                <p>Buy it now</p>
                            </div>
                        </div>
                        <div class="product__secondary">
                            <div class="badge">Title only</div>
                        </div>
                    </div>
                {% endfor %}
                <div class="vstack centered action padding-double">
                    <p>Add another product</p>
                    <a href="{{ path('new_product') }}" class="btn">Add</a>
                </div>
            </div>
        </turbo-frame>
        <section></section>
    </div>
    {# <div class="divider-block"></div> #}
{% endblock %}
